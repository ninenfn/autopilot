{"name": "test_create_driver_integrity_error", "status": "broken", "statusDetails": {"message": "fastapi.exceptions.ResponseValidationError: 2 validation errors:\n  {'type': 'string_type', 'loc': ('response', 'license_number'), 'msg': 'Input should be a valid string', 'input': <MagicMock name='create_driver().license_number' id='2319120276624'>, 'url': 'https://errors.pydantic.dev/2.5/v/string_type'}\n  {'type': 'string_type', 'loc': ('response', 'status'), 'msg': 'Input should be a valid string', 'input': <MagicMock name='create_driver().status' id='2319120316400'>, 'url': 'https://errors.pydantic.dev/2.5/v/string_type'}", "trace": "self = <tests.test_drivers.TestDriversAPIErrorHandling object at 0x0000021BF641F2E0>\nclient = <starlette.testclient.TestClient object at 0x0000021BF637BA60>\n\n    def test_create_driver_integrity_error(self, client):\n        \"\"\"Тест обработки IntegrityError при создании водителя\"\"\"\n        from sqlalchemy.exc import IntegrityError\n    \n        with patch(\"app.api.drivers.DriverService.create_driver\") as mock_create:\n    \n    \n            driver_data = {\n                \"user_id\": 1,\n                \"license_number\": \"DUPLICATE123\",\n                \"years_of_experience\": 5,\n            }\n    \n>           response = client.post(\"/drivers/\", json=driver_data)\n\ntests\\test_drivers.py:141: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:590: in post\n    return super().post(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:1132: in post\n    return self.request(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:465: in request\n    return super().request(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:342: in handle_request\n    raise exc\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:339: in handle_request\n    portal.call(self.app, scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\anyio\\from_thread.py:277: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\concurrent\\futures\\_base.py:446: in result\n    return self.__get_result()\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\concurrent\\futures\\_base.py:391: in __get_result\n    raise self._exception\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\anyio\\from_thread.py:217: in _call_func\n    retval = await retval\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\applications.py:1106: in __call__\n    await super().__call__(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\applications.py:122: in __call__\n    await self.middleware_stack(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\errors.py:184: in __call__\n    raise exc\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\errors.py:162: in __call__\n    await self.app(scope, receive, _send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\exceptions.py:79: in __call__\n    raise exc\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\exceptions.py:68: in __call__\n    await self.app(scope, receive, sender)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py:20: in __call__\n    raise e\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py:17: in __call__\n    await self.app(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\routing.py:718: in __call__\n    await route.handle(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\routing.py:276: in handle\n    await self.app(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\routing.py:66: in app\n    response = await func(request)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\routing.py:292: in app\n    content = await serialize_response(\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\n    async def serialize_response(\n        *,\n        field: Optional[ModelField] = None,\n        response_content: Any,\n        include: Optional[IncEx] = None,\n        exclude: Optional[IncEx] = None,\n        by_alias: bool = True,\n        exclude_unset: bool = False,\n        exclude_defaults: bool = False,\n        exclude_none: bool = False,\n        is_coroutine: bool = True,\n    ) -> Any:\n        if field:\n            errors = []\n            if not hasattr(field, \"serialize\"):\n                # pydantic v1\n                response_content = _prepare_response_content(\n                    response_content,\n                    exclude_unset=exclude_unset,\n                    exclude_defaults=exclude_defaults,\n                    exclude_none=exclude_none,\n                )\n            if is_coroutine:\n                value, errors_ = field.validate(response_content, {}, loc=(\"response\",))\n            else:\n                value, errors_ = await run_in_threadpool(\n                    field.validate, response_content, {}, loc=(\"response\",)\n                )\n            if isinstance(errors_, list):\n                errors.extend(errors_)\n            elif errors_:\n                errors.append(errors_)\n            if errors:\n>               raise ResponseValidationError(\n                    errors=_normalize_errors(errors), body=response_content\n                )\nE               fastapi.exceptions.ResponseValidationError: 2 validation errors:\nE                 {'type': 'string_type', 'loc': ('response', 'license_number'), 'msg': 'Input should be a valid string', 'input': <MagicMock name='create_driver().license_number' id='2319120276624'>, 'url': 'https://errors.pydantic.dev/2.5/v/string_type'}\nE                 {'type': 'string_type', 'loc': ('response', 'status'), 'msg': 'Input should be a valid string', 'input': <MagicMock name='create_driver().status' id='2319120316400'>, 'url': 'https://errors.pydantic.dev/2.5/v/string_type'}\n\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\routing.py:155: ResponseValidationError"}, "description": "Тест обработки IntegrityError при создании водителя", "start": 1763733248371, "stop": 1763733248377, "uuid": "67cd245d-1dad-4a4a-bf16-8aa17e37525b", "historyId": "6fe07fbd330f27aceca0daf7b452d92e", "testCaseId": "6fe07fbd330f27aceca0daf7b452d92e", "fullName": "tests.test_drivers.TestDriversAPIErrorHandling#test_create_driver_integrity_error", "labels": [{"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_drivers"}, {"name": "subSuite", "value": "TestDriversAPIErrorHandling"}, {"name": "host", "value": "DESKTOP-J9T79FF"}, {"name": "thread", "value": "15852-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_drivers"}], "titlePath": ["tests", "test_drivers.py", "TestDriversAPIErrorHandling"]}