{"name": "test_get_drivers_service_exception", "status": "broken", "statusDetails": {"message": "AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'", "trace": "status = None, skip = 0, limit = 100, db = <sqlalchemy.orm.session.Session object at 0x0000019E01113AC0>\n\n    @router.get(\n        \"/\",\n        response_model=List[DriverResponse],\n        summary=\"Получить список водителей\"\n    )\n    async def get_drivers(\n        status: Optional[DriverStatus] = Query(None, description=\"Фильтр по статусу верификации\"),\n        skip: int = Query(0, ge=0),\n        limit: int = Query(100, ge=1, le=1000),\n        db: Session = Depends(get_db)\n    ):\n        \"\"\"\n        Получение списка водителей с возможностью фильтрации по статусу.\n    \n        - **status**: Статус верификации (PENDING, VERIFIED, REJECTED)\n        - **skip**: Количество записей для пропуска (пагинация)\n        - **limit**: Максимальное количество записей\n        \"\"\"\n        try:\n>           drivers = DriverService.get_drivers(db, status, skip, limit)\n\napp\\api\\drivers.py:68: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py:1104: in __call__\n    return self._mock_call(*args, **kwargs)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py:1108: in _mock_call\n    return self._execute_mock_call(*args, **kwargs)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nself = <MagicMock name='get_drivers' id='1778134395168'>\nargs = (<sqlalchemy.orm.session.Session object at 0x0000019E01113AC0>, None, 0, 100), kwargs = {}, effect = Exception('DB error')\n\n    def _execute_mock_call(self, /, *args, **kwargs):\n        # separate from _increment_mock_call so that awaited functions are\n        # executed separately from their call, also AsyncMock overrides this method\n    \n        effect = self.side_effect\n        if effect is not None:\n            if _is_exception(effect):\n>               raise effect\nE               Exception: DB error\n\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\unittest\\mock.py:1163: Exception\n\nDuring handling of the above exception, another exception occurred:\n\nself = <tests.test_drivers.TestDriversAPIErrorHandling object at 0x0000019E01168580>\nclient = <starlette.testclient.TestClient object at 0x0000019E01112AA0>\n\n    def test_get_drivers_service_exception(self, client):\n        \"\"\"Тест обработки исключения из сервиса при получении\"\"\"\n        with patch('app.api.drivers.DriverService.get_drivers') as mock:\n            mock.side_effect = Exception(\"DB error\")\n    \n>           response = client.get(\"/drivers/\")\n\ntests\\test_drivers.py:157: \n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:499: in get\n    return super().get(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:1041: in get\n    return self.request(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:465: in request\n    return super().request(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:814: in request\n    return self.send(request, auth=auth, follow_redirects=follow_redirects)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:901: in send\n    response = self._send_handling_auth(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:929: in _send_handling_auth\n    response = self._send_handling_redirects(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:966: in _send_handling_redirects\n    response = self._send_single_request(request)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\httpx\\_client.py:1002: in _send_single_request\n    response = transport.handle_request(request)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:342: in handle_request\n    raise exc\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\testclient.py:339: in handle_request\n    portal.call(self.app, scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\anyio\\from_thread.py:277: in call\n    return cast(T_Retval, self.start_task_soon(func, *args).result())\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\concurrent\\futures\\_base.py:446: in result\n    return self.__get_result()\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\concurrent\\futures\\_base.py:391: in __get_result\n    raise self._exception\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\anyio\\from_thread.py:217: in _call_func\n    retval = await retval\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\applications.py:1106: in __call__\n    await super().__call__(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\applications.py:122: in __call__\n    await self.middleware_stack(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\errors.py:184: in __call__\n    raise exc\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\errors.py:162: in __call__\n    await self.app(scope, receive, _send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\exceptions.py:79: in __call__\n    raise exc\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\middleware\\exceptions.py:68: in __call__\n    await self.app(scope, receive, sender)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py:20: in __call__\n    raise e\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\middleware\\asyncexitstack.py:17: in __call__\n    await self.app(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\routing.py:718: in __call__\n    await route.handle(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\routing.py:276: in handle\n    await self.app(scope, receive, send)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\starlette\\routing.py:66: in app\n    response = await func(request)\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\routing.py:274: in app\n    raw_response = await run_endpoint_function(\n..\\..\\..\\AppData\\Local\\Programs\\Python\\Python310\\lib\\site-packages\\fastapi\\routing.py:191: in run_endpoint_function\n    return await dependant.call(**values)\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _\n\nstatus = None, skip = 0, limit = 100, db = <sqlalchemy.orm.session.Session object at 0x0000019E01113AC0>\n\n    @router.get(\n        \"/\",\n        response_model=List[DriverResponse],\n        summary=\"Получить список водителей\"\n    )\n    async def get_drivers(\n        status: Optional[DriverStatus] = Query(None, description=\"Фильтр по статусу верификации\"),\n        skip: int = Query(0, ge=0),\n        limit: int = Query(100, ge=1, le=1000),\n        db: Session = Depends(get_db)\n    ):\n        \"\"\"\n        Получение списка водителей с возможностью фильтрации по статусу.\n    \n        - **status**: Статус верификации (PENDING, VERIFIED, REJECTED)\n        - **skip**: Количество записей для пропуска (пагинация)\n        - **limit**: Максимальное количество записей\n        \"\"\"\n        try:\n            drivers = DriverService.get_drivers(db, status, skip, limit)\n            return drivers\n        except Exception as e:\n            raise HTTPException(\n>               status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=f\"Internal server error: {str(e)}\"\n            )\nE           AttributeError: 'NoneType' object has no attribute 'HTTP_500_INTERNAL_SERVER_ERROR'\n\napp\\api\\drivers.py:72: AttributeError"}, "description": "Тест обработки исключения из сервиса при получении", "start": 1763726394088, "stop": 1763726394091, "uuid": "e8f2b7c5-5aae-466d-8efa-b65d8a067e81", "historyId": "7d65749cb92d0f1b0540e4d4fa057f2e", "testCaseId": "7d65749cb92d0f1b0540e4d4fa057f2e", "fullName": "tests.test_drivers.TestDriversAPIErrorHandling#test_get_drivers_service_exception", "labels": [{"name": "parentSuite", "value": "tests"}, {"name": "suite", "value": "test_drivers"}, {"name": "subSuite", "value": "TestDriversAPIErrorHandling"}, {"name": "host", "value": "DESKTOP-J9T79FF"}, {"name": "thread", "value": "19340-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "tests.test_drivers"}], "titlePath": ["tests", "test_drivers.py", "TestDriversAPIErrorHandling"]}
